<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Through My Eyes - TSA Restaurant 3D</title>
<style>
body, html {margin:0; padding:0; overflow:hidden; font-family:Arial; background:#f0f0f0;}
#menu {display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; text-align:center;}
button {padding:15px 25px; font-size:18px; margin:15px; border:none; border-radius:10px; cursor:pointer; background:#4CAF50; color:white;}
#experience {display:none; width:100%; height:100vh; position:relative;}
#mission {position:absolute; top:10px; width:100%; text-align:center; font-size:22px; font-weight:bold; background:white; padding:10px; z-index:10;}
#calmBtn, #exitBtn {position:absolute; top:50px; right:20px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; z-index:10; background:#2196F3; color:white;}
#surchargeBar {position:absolute; top:90px; left:5%; width:90%; height:15px; background:#ddd; border-radius:8px; z-index:10;}
#surchargeLevel {height:100%; width:0%; background:red; border-radius:8px; transition:0.3s;}
#world {width:100%; height:100%;}
</style>
</head>
<body>

<div id="menu">
  <h1>Vivez l'exp√©rience Through My Eyes</h1>
  <p>Choisissez un th√®me pour d√©couvrir la sant√© mentale</p>
  <button onclick="startExperience('tsa_restaurant')">üåà Mode TSA Restaurant 3D</button>
</div>

<div id="experience">
  <div id="mission"></div>
  <button id="calmBtn" onclick="toggleCalm()">üåø Mode Calme</button>
  <button id="exitBtn" onclick="exitExperience()">üè† Quitter</button>
  <div id="surchargeBar"><div id="surchargeLevel"></div></div>
  <div id="world"></div>
</div>

<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

<script>
let mode="", level=0, surcharge=document.getElementById("surchargeLevel"), calm=false;
let world=document.getElementById("world"), surchargeInterval, animateId, activeSounds=[];

// Sons 3D spatialis√©s simplifi√©s
let restaurantSounds=["https://www.soundjay.com/misc/sounds/restaurant-ambience-1.mp3"];

function playSounds(list){
  stopAllSounds();
  activeSounds=list.map(src=>{
    let a=new Audio(src);
    a.loop=true; a.volume=0.1; a.play();
    return a;
  });
}
function stopAllSounds(){activeSounds.forEach(a=>a.pause()); activeSounds=[];}

// Three.js
let scene, camera, renderer, controls, tables=[], clients=[], interactiveObjects=[];

function init3DRestaurant(){
  world.innerHTML="";
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0xf0f0f0);

  camera=new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,1.6,5);
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  world.appendChild(renderer.domElement);

  // Lumi√®res
  const light=new THREE.AmbientLight(0xffffff,1);
  scene.add(light);
  const dirLight=new THREE.DirectionalLight(0xffffff,0.5);
  dirLight.position.set(0,10,5);
  scene.add(dirLight);

  // Sol
  const floor=new THREE.Mesh(new THREE.PlaneGeometry(20,20), new THREE.MeshStandardMaterial({color:0xf5f5dc}));
  floor.rotation.x=-Math.PI/2; scene.add(floor);

  // Tables et clients anim√©s
  tables=[]; clients=[]; interactiveObjects=[];
  for(let i=-2;i<=2;i++){
    for(let j=-2;j<=2;j++){
      // Table
      const table=new THREE.Mesh(new THREE.BoxGeometry(1,0.1,1), new THREE.MeshStandardMaterial({color:0x8B4513}));
      table.position.set(i*2,0.05,j*2);
      scene.add(table);
      tables.push(table);

      // Client (simple cube)
      const client=new THREE.Mesh(new THREE.BoxGeometry(0.3,0.5,0.3), new THREE.MeshStandardMaterial({color:0x00aaff}));
      client.position.set(i*2,0.25,j*2);
      scene.add(client);
      clients.push(client);
    }
  }

  // Interaction cliquable sur une table choisie
  interactiveObjects.push({object:tables[0], action:()=>alert("üéâ Table s√©lectionn√©e !")});

  // Controls (pour tester la sc√®ne)
  controls=new THREE.OrbitControls(camera,renderer.domElement);
  controls.enablePan=false;
  controls.enableZoom=false;

  animate3D();
}

function animate3D(){
  // Tremblement l√©ger selon surcharge
  if(!calm) camera.position.x=Math.sin(level/20)*0.5;
  // Clients anim√©s (simple rotation)
  clients.forEach(c=>c.rotation.y+=0.01*(1+level/50));

  renderer.render(scene,camera);
  animateId=requestAnimationFrame(animate3D);
}

// D√©marrage exp√©rience
function startExperience(selectedMode){
  mode=selectedMode;
  document.getElementById("menu").style.display="none";
  document.getElementById("experience").style.display="block";
  level=0; calm=false; updateSurcharge();

  document.getElementById("mission").innerText="üçΩÔ∏è Mission : Rep√®re ta table et commande ton plat malgr√© la surcharge.";
  playSounds(restaurantSounds);
  init3DRestaurant();

  startSurcharge();
}

// Surcharge progressive
function startSurcharge(){
  surchargeInterval=setInterval(()=>{
    if(level<100) level+=1;
    updateSurcharge();
  },500);
}
function updateSurcharge(){surcharge.style.width=level+"%";}

// Mode calme
function toggleCalm(){
  calm=!calm;
  level=level/2;
  updateSurcharge();
  activeSounds.forEach(s=>s.volume=calm?0.05:0.1);
}

// Quitter exp√©rience
function exitExperience(){
  clearInterval(surchargeInterval);
  cancelAnimationFrame(animateId);
  stopAllSounds();
  world.innerHTML="";
  document.getElementById("experience").style.display="none";
  document.getElementById("menu").style.display="flex";
  level=0; updateSurcharge();
}
</script>
</body>
</html>
